<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المليونير الذهبي - اللعبة</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="game-container" id="game-container">
        <div class="container">
            <div id="game-screen" class="screen active">
                <div class="game-header">
                    <div class="player-info-bar">
                        <div class="player-avatar">
                            <i class="fas fa-user"></i>
                            <div class="player-level" id="player-level">1</div>
                        </div>
                        <div class="player-details">
                            <div class="player-name" id="current-player">اللاعب</div>
                            <div class="player-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progress-fill" style="width: 6.66%"></div>
                                </div>
                                <div class="progress-text" id="progress-percent">6.66%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="game-controls-bar">
                        <div class="control-group">
                            <button class="control-btn" id="sound-toggle">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <button class="control-btn" id="help-btn">
                                <i class="fas fa-question-circle"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="game-stats-bar">
                        <div class="stat-item">
                            <i class="fas fa-clock"></i>
                            <div class="timer-display" id="timer">30</div>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-coins"></i>
                            <div class="prize-display" id="current-prize">100</div>
                        </div>
                    </div>
                </div>
                
                <div class="game-main">
                    <div class="question-section">
                        <div class="question-header">
                            <div class="question-meta">
                                <div class="question-category" id="question-category">عام</div>
                                <div class="question-difficulty" id="question-difficulty">★☆☆☆☆</div>
                            </div>
                            <div class="question-counter">
                                <i class="fas fa-question-circle"></i>
                                <span>سؤال <span id="q-number">1</span> من 15</span>
                            </div>
                        </div>
                        
                        <div class="question-card">
                            <div class="question-text" id="question-text">
                                جاري تحميل السؤال...
                            </div>
                            <div class="question-hint" id="question-hint"></div>
                        </div>
                        
                        <div class="options-grid">
                            <div class="option-card" id="option-a-card">
                                <div class="option-header">
                                    <div class="option-letter">أ</div>
                                    <div class="option-indicator"></div>
                                </div>
                                <div class="option-content">
                                    <div class="option-text" id="option-a">جاري التحميل...</div>
                                </div>
                                <div class="option-check">
                                    <i class="fas fa-check"></i>
                                </div>
                            </div>
                            
                            <div class="option-card" id="option-b-card">
                                <div class="option-header">
                                    <div class="option-letter">ب</div>
                                    <div class="option-indicator"></div>
                                </div>
                                <div class="option-content">
                                    <div class="option-text" id="option-b">جاري التحميل...</div>
                                </div>
                                <div class="option-check">
                                    <i class="fas fa-check"></i>
                                </div>
                            </div>
                            
                            <div class="option-card" id="option-c-card">
                                <div class="option-header">
                                    <div class="option-letter">ج</div>
                                    <div class="option-indicator"></div>
                                </div>
                                <div class="option-content">
                                    <div class="option-text" id="option-c">جاري التحميل...</div>
                                </div>
                                <div class="option-check">
                                    <i class="fas fa-check"></i>
                                </div>
                            </div>
                            
                            <div class="option-card" id="option-d-card">
                                <div class="option-header">
                                    <div class="option-letter">د</div>
                                    <div class="option-indicator"></div>
                                </div>
                                <div class="option-content">
                                    <div class="option-text" id="option-d">جاري التحميل...</div>
                                </div>
                                <div class="option-check">
                                    <i class="fas fa-check"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="game-actions">
                            <button class="action-btn withdraw-btn" id="withdraw-btn">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>انسحب آمن</span>
                            </button>
                            
                            <div class="lifelines-container">
                                <button class="lifeline-btn" id="fifty-fifty">
                                    <div class="lifeline-icon">
                                        <i class="fas fa-balance-scale"></i>
                                    </div>
                                    <div class="lifeline-text">50:50</div>
                                </button>
                                
                                <button class="lifeline-btn" id="ask-audience">
                                    <div class="lifeline-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="lifeline-text">سؤال الجمهور</div>
                                </button>
                                
                                <button class="lifeline-btn" id="phone-friend">
                                    <div class="lifeline-icon">
                                        <i class="fas fa-phone-alt"></i>
                                    </div>
                                    <div class="lifeline-text">الاتصال بصديق</div>
                                </button>
                            </div>
                            
                            <button class="action-btn next-btn disabled" id="next-btn" disabled>
                                <i class="fas fa-arrow-left"></i>
                                <span>التالي</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="prizes-section">
                        <div class="prizes-header">
                            <i class="fas fa-trophy"></i>
                            <h3>قائمة الجوائز</h3>
                        </div>
                        <div class="prizes-list" id="prizes-list"></div>
                        <div class="prizes-footer">
                            <div class="total-prize">
                                <i class="fas fa-crown"></i>
                                <div class="total-amount" id="total-prize">0</div>
                                <div class="total-label">الجائزة الحالية</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="game-footer">
                    <div class="footer-info">
                        <div class="tips">
                            <i class="fas fa-lightbulb"></i>
                            <span id="game-tip">يمكنك استخدام المساعدات عند الحاجة</span>
                        </div>
                    </div>
                    <div class="footer-credits">
                        <span>المليونير الذهبي - الإصدار 2.0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نوافذ منبثقة -->
    <div id="withdraw-modal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-container">
            <div class="modal-header">
                <h3><i class="fas fa-sign-out-alt warning-icon"></i> تأكيد الانسحاب</h3>
                <button class="modal-close" id="close-withdraw">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="withdraw-content">
                    <div class="withdraw-icon">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                    <div class="withdraw-info">
                        <h4>انسحاب آمن</h4>
                        <p>إذا انسحبت الآن، ستحصل على الجائزة الآمنة التالية:</p>
                        <div class="withdraw-amount">
                            <span class="amount-label">قيمة الجائزة:</span>
                            <span class="amount-value" id="withdraw-amount">0</span>
                        </div>
                        <p>هل أنت متأكد من رغبتك في الانسحاب؟</p>
                    </div>
                    <div class="withdraw-notice">
                        <i class="fas fa-exclamation-triangle"></i>
                        <small>إذا استمريت في اللعب قد تربح أكثر، لكن قد تخسر الجائزة الحالية</small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn danger" id="confirm-withdraw">نعم، انسحب</button>
                <button class="modal-btn outline" id="continue-playing">لا، استمر في اللعب</button>
            </div>
        </div>
    </div>

    <div id="help-modal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-container">
            <div class="modal-header">
                <h3><i class="fas fa-info-circle"></i> تعليمات اللعبة</h3>
                <button class="modal-close" id="close-help">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="instructions-content">
                    <div class="instruction-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>هدف اللعبة</h4>
                            <p>أجب على 15 سؤالاً بشكل صحيح لتربح مليون دولار!</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>خطوط الأمان</h4>
                            <p>عند الوصول إلى السؤال 5 و 10، تكون الجائزة مضمونة حتى لو أجبت خطأ.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>المساعدات</h4>
                            <ul>
                                <li><strong>50:50</strong> - تزيل إجابتين خاطئتين</li>
                                <li><strong>سؤال الجمهور</strong> - استشارة المشاهدين</li>
                                <li><strong>الاتصال بصديق</strong> - استفسر من خبير</li>
                            </ul>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>الانسحاب</h4>
                            <p>يمكنك الانسحاب في أي وقت وأخذ الجائزة الحالية.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn" id="start-after-help">فهمت، ابدأ اللعبة!</button>
            </div>
        </div>
    </div>

    <!-- ملف JavaScript الرئيسي مبسط -->
    <script type="module">
        // ملف main.js مبسط يعمل مباشرة
        import { CONFIG, PRIZES } from './js/config.js';
        
        // كود اللعبة الأساسي هنا (نفس الكود السابق من main.js)
        class GameState {
            constructor() {
                this.reset();
            }

            reset() {
                this.playerName = '';
                this.currentQuestion = 0;
                this.score = 0;
                this.totalCorrect = 0;
                this.totalTime = 0;
                this.lifelines = {
                    fiftyFifty: true,
                    askAudience: true,
                    phoneFriend: true
                };
                this.usedQuestions = [];
                this.gameActive = false;
                this.isPaused = false;
                this.selectedOption = null;
                this.startTime = null;
                this.answered = false;
            }

            start(playerName) {
                this.reset();
                this.playerName = playerName;
                this.gameActive = true;
                this.startTime = Date.now();
                this.usedQuestions = [];
            }

            nextQuestion() {
                if (this.currentQuestion < CONFIG.TOTAL_QUESTIONS - 1) {
                    this.currentQuestion++;
                    this.selectedOption = null;
                    this.answered = false;
                    return true;
                }
                return false;
            }

            updateScore(isCorrect) {
                if (isCorrect) {
                    this.score = PRIZES[this.currentQuestion];
                    this.totalCorrect++;
                }
            }

            getCurrentPrize() {
                return PRIZES[this.currentQuestion] || 0;
            }

            getSafePrize() {
                for (let i = this.currentQuestion; i >= 0; i--) {
                    if (CONFIG.SAFE_HAVEN_LEVELS.includes(i + 1) || i === 0) {
                        return PRIZES[i];
                    }
                }
                return 0;
            }

            useLifeline(lifeline) {
                if (this.lifelines[lifeline]) {
                    this.lifelines[lifeline] = false;
                    return true;
                }
                return false;
            }

            getRemainingLifelines() {
                return Object.values(this.lifelines).filter(v => v).length;
            }

            getPlayTime() {
                if (!this.startTime) return 0;
                return Math.floor((Date.now() - this.startTime) / 1000);
            }

            getAccuracy() {
                if (this.currentQuestion === 0) return 0;
                return Math.round((this.totalCorrect / (this.currentQuestion + 1)) * 100);
            }
        }

        class MillionaireGame {
            constructor() {
                this.gameState = new GameState();
                this.currentTimer = null;
                this.questions = [];
                this.currentQuestionObj = null;
                this.init();
            }

            init() {
                console.log(`${CONFIG.APP_NAME} - الإصدار ${CONFIG.VERSION}`);
                
                this.gameState.playerName = localStorage.getItem('millionairePlayerName') || 'اللاعب';
                
                if (!this.gameState.playerName) {
                    this.redirectToStart();
                    return;
                }
                
                this.startGame();
            }

            redirectToStart() {
                const container = document.getElementById('game-container');
                if (container) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 50px;">
                            <h1>الرجاء إدخال اسمك أولاً</h1>
                            <p>سيتم توجيهك لشاشة البداية خلال 3 ثوان...</p>
                        </div>
                    `;
                }
                
                setTimeout(() => {
                    window.location.href = 'start.html';
                }, 3000);
            }

            startGame() {
                this.gameState.start(this.gameState.playerName);
                this.loadQuestions();
                this.updateUI();
                this.setupEventListeners();
                this.showQuestion();
            }

            loadQuestions() {
                this.questions = [
                    {
                        id: 1,
                        question: "ما هي عاصمة فرنسا؟",
                        options: ["لندن", "برلين", "باريس", "مدريد"],
                        correct: 2,
                        category: "جغرافيا",
                        difficulty: "سهل",
                        hint: "مدينة النور"
                    },
                    {
                        id: 2,
                        question: "كم عدد أيام الأسبوع؟",
                        options: ["5", "6", "7", "8"],
                        correct: 2,
                        category: "معلومات عامة",
                        difficulty: "سهل",
                        hint: "بداية من السبت"
                    },
                    {
                        id: 3,
                        question: "ما هو الكوكب الأحمر؟",
                        options: ["الزهرة", "المريخ", "المشتري", "زحل"],
                        correct: 1,
                        category: "علوم",
                        difficulty: "سهل",
                        hint: "سمي بلونه المميز"
                    },
                    {
                        id: 4,
                        question: "ما هو لون التفاحة الناضجة؟",
                        options: ["أخضر", "أصفر", "أحمر", "بنفسجي"],
                        correct: 2,
                        category: "معلومات عامة",
                        difficulty: "سهل",
                        hint: "لون شائع للتفاح"
                    },
                    {
                        id: 5,
                        question: "كم عدد أحرف اللغة العربية؟",
                        options: ["26", "28", "30", "32"],
                        correct: 1,
                        category: "لغة",
                        difficulty: "سهل",
                        hint: "عدد الحروف"
                    },
                    {
                        id: 6,
                        question: "من هو مؤسس الدولة الأموية؟",
                        options: ["معاوية بن أبي سفيان", "عمر بن الخطاب", "علي بن أبي طالب", "عثمان بن عفان"],
                        correct: 0,
                        category: "تاريخ",
                        difficulty: "متوسط",
                        hint: "ابن أبي سفيان"
                    },
                    {
                        id: 7,
                        question: "ما هو العنصر الكيميائي برمزه 'O'؟",
                        options: ["ذهب", "أكسجين", "فضة", "نحاس"],
                        correct: 1,
                        category: "علوم",
                        difficulty: "متوسط",
                        hint: "ضروري للتنفس"
                    },
                    {
                        id: 8,
                        question: "في أي دولة تقع برج إيفل؟",
                        options: ["إيطاليا", "فرنسا", "إسبانيا", "ألمانيا"],
                        correct: 1,
                        category: "جغرافيا",
                        difficulty: "متوسط",
                        hint: "عاصمتها باريس"
                    },
                    {
                        id: 9,
                        question: "ما هو الحيوان الوطني لأستراليا؟",
                        options: ["الكنغر", "الدب", "الأسد", "النمر"],
                        correct: 0,
                        category: "معلومات عامة",
                        difficulty: "متوسط",
                        hint: "يقفز"
                    },
                    {
                        id: 10,
                        question: "من كتب رواية 'البؤساء'؟",
                        options: ["فيكتور هوغو", "شارل ديكنز", "ليو تولستوي", "جورج أورويل"],
                        correct: 0,
                        category: "أدب",
                        difficulty: "متوسط",
                        hint: "كاتب فرنسي"
                    },
                    {
                        id: 11,
                        question: "كم عدد غرف البيت الأبيض؟",
                        options: ["132", "147", "156", "168"],
                        correct: 0,
                        category: "معلومات عامة",
                        difficulty: "صعب",
                        hint: "مقر الرئيس الأمريكي"
                    },
                    {
                        id: 12,
                        question: "ما هو أسرع حيوان بري؟",
                        options: ["الفهد", "الأسد", "النمر", "الذئب"],
                        correct: 0,
                        category: "علوم",
                        difficulty: "صعب",
                        hint: "يملك بقعاً"
                    },
                    {
                        id: 13,
                        question: "من هو مخترع الهاتف؟",
                        options: ["غراهام بيل", "توماس إديسون", "نيكولا تيسلا", "ألكسندر بوبوف"],
                        correct: 0,
                        category: "تاريخ",
                        difficulty: "صعب",
                        hint: "اخترع عام 1876"
                    },
                    {
                        id: 14,
                        question: "ما هي أكبر صحراء في العالم؟",
                        options: ["الصحراء الكبرى", "صحراء الربع الخالي", "صحراء جوبي", "صحراء أنتاركتيكا"],
                        correct: 3,
                        category: "جغرافيا",
                        difficulty: "صعب",
                        hint: "في القارة القطبية الجنوبية"
                    },
                    {
                        id: 15,
                        question: "كم عدد عظام جسم الإنسان البالغ؟",
                        options: ["206", "214", "198", "220"],
                        correct: 0,
                        category: "علوم",
                        difficulty: "صعب",
                        hint: "رقم معروف"
                    }
                ];
            }

            updateUI() {
                const playerNameEl = document.getElementById('current-player');
                if (playerNameEl) {
                    playerNameEl.textContent = this.gameState.playerName;
                }
                
                const levelEl = document.getElementById('player-level');
                if (levelEl) {
                    levelEl.textContent = Math.min(Math.floor(this.gameState.currentQuestion / 5) + 1, 3);
                }
            }

            showQuestion() {
                if (this.gameState.currentQuestion >= this.questions.length) {
                    this.endGame(true);
                    return;
                }

                this.currentQuestionObj = this.questions[this.gameState.currentQuestion];
                
                document.getElementById('question-text').textContent = this.currentQuestionObj.question;
                document.getElementById('question-category').textContent = this.currentQuestionObj.category;
                document.getElementById('question-hint').textContent = this.currentQuestionObj.hint;
                document.getElementById('q-number').textContent = this.gameState.currentQuestion + 1;
                
                let stars = "";
                switch(this.currentQuestionObj.difficulty) {
                    case "سهل": stars = "★☆☆☆☆"; break;
                    case "متوسط": stars = "★★☆☆☆"; break;
                    case "صعب": stars = "★★★☆☆"; break;
                    default: stars = "★☆☆☆☆";
                }
                document.getElementById('question-difficulty').textContent = stars;
                
                document.getElementById('option-a').textContent = this.currentQuestionObj.options[0];
                document.getElementById('option-b').textContent = this.currentQuestionObj.options[1];
                document.getElementById('option-c').textContent = this.currentQuestionObj.options[2];
                document.getElementById('option-d').textContent = this.currentQuestionObj.options[3];
                
                const prize = this.gameState.getCurrentPrize();
                document.getElementById('current-prize').textContent = prize.toLocaleString();
                document.getElementById('total-prize').textContent = prize.toLocaleString();
                
                const progress = ((this.gameState.currentQuestion + 1) / 15) * 100;
                const progressFill = document.getElementById('progress-fill');
                const progressPercent = document.getElementById('progress-percent');
                
                if (progressFill) progressFill.style.width = `${progress}%`;
                if (progressPercent) progressPercent.textContent = `${progress.toFixed(2)}%`;
                
                const levelEl = document.getElementById('player-level');
                if (levelEl) {
                    levelEl.textContent = Math.min(Math.floor(this.gameState.currentQuestion / 5) + 1, 3);
                }
                
                this.updatePrizesList();
                this.resetOptions();
                this.startTimer();
            }

            updatePrizesList() {
                const prizesList = document.getElementById('prizes-list');
                if (!prizesList) return;
                
                prizesList.innerHTML = '';
                
                PRIZES.forEach((prize, index) => {
                    const prizeItem = document.createElement('div');
                    prizeItem.className = 'prize-item';
                    
                    if (index === this.gameState.currentQuestion) {
                        prizeItem.classList.add('current');
                    } else if (index < this.gameState.currentQuestion) {
                        prizeItem.classList.add('passed');
                    } else {
                        prizeItem.classList.add('future');
                    }
                    
                    if (CONFIG.SAFE_HAVEN_LEVELS.includes(index + 1)) {
                        prizeItem.classList.add('safe');
                    }
                    
                    prizeItem.innerHTML = `
                        <div class="prize-rank">${index + 1}</div>
                        <div class="prize-amount">${prize.toLocaleString()} $</div>
                    `;
                    
                    prizesList.appendChild(prizeItem);
                });
            }

            resetOptions() {
                const optionCards = document.querySelectorAll('.option-card');
                optionCards.forEach(card => {
                    card.classList.remove('correct', 'wrong', 'selected');
                    card.disabled = false;
                    card.style.opacity = '1';
                    card.style.pointerEvents = 'auto';
                });
                
                const nextBtn = document.getElementById('next-btn');
                if (nextBtn) {
                    nextBtn.disabled = true;
                    nextBtn.classList.add('disabled');
                }
            }

            startTimer() {
                let timeLeft = CONFIG.TIME_PER_QUESTION;
                const timerDisplay = document.getElementById('timer');
                if (!timerDisplay) return;
                
                timerDisplay.textContent = timeLeft;
                timerDisplay.classList.remove('warning', 'danger');
                
                clearInterval(this.currentTimer);
                this.currentTimer = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;
                    
                    if (timeLeft <= 10) {
                        timerDisplay.classList.add('warning');
                    }
                    if (timeLeft <= 5) {
                        timerDisplay.classList.add('danger');
                    }
                    if (timeLeft <= 0) {
                        clearInterval(this.currentTimer);
                        this.timeUp();
                    }
                }, 1000);
            }

            timeUp() {
                alert('انتهى الوقت!');
                this.endGame(false);
            }

            setupEventListeners() {
                // الخيارات
                document.getElementById('option-a-card').addEventListener('click', () => this.checkAnswer(0));
                document.getElementById('option-b-card').addEventListener('click', () => this.checkAnswer(1));
                document.getElementById('option-c-card').addEventListener('click', () => this.checkAnswer(2));
                document.getElementById('option-d-card').addEventListener('click', () => this.checkAnswer(3));
                
                // زر التالي
                document.getElementById('next-btn').addEventListener('click', () => this.nextQuestion());
                
                // زر الانسحاب
                document.getElementById('withdraw-btn').addEventListener('click', () => this.showWithdrawModal());
                
                // المساعدات
                document.getElementById('fifty-fifty').addEventListener('click', () => this.useFiftyFifty());
                document.getElementById('ask-audience').addEventListener('click', () => this.useAskAudience());
                document.getElementById('phone-friend').addEventListener('click', () => this.usePhoneFriend());
                
                // التحكم بالصوت
                document.getElementById('sound-toggle').addEventListener('click', () => this.toggleSound());
                
                // التعليمات
                document.getElementById('help-btn').addEventListener('click', () => this.showHelpModal());
                
                // نافذة الانسحاب
                document.getElementById('confirm-withdraw')?.addEventListener('click', () => this.confirmWithdraw());
                document.getElementById('continue-playing')?.addEventListener('click', () => {
                    document.getElementById('withdraw-modal').classList.remove('active');
                });
                document.getElementById('close-withdraw')?.addEventListener('click', () => {
                    document.getElementById('withdraw-modal').classList.remove('active');
                });
                
                // نافذة التعليمات
                document.getElementById('start-after-help')?.addEventListener('click', () => {
                    document.getElementById('help-modal').classList.remove('active');
                });
                document.getElementById('close-help')?.addEventListener('click', () => {
                    document.getElementById('help-modal').classList.remove('active');
                });
            }

            checkAnswer(selectedIndex) {
                if (this.gameState.answered || !this.gameState.gameActive) return;
                this.gameState.answered = true;
                
                clearInterval(this.currentTimer);
                
                const isCorrect = selectedIndex === this.currentQuestionObj.correct;
                const optionCards = document.querySelectorAll('.option-card');
                const selectedCard = optionCards[selectedIndex];
                const correctCard = optionCards[this.currentQuestionObj.correct];
                
                if (selectedCard) selectedCard.classList.add(isCorrect ? 'correct' : 'wrong');
                if (!isCorrect && correctCard) correctCard.classList.add('correct');
                
                optionCards.forEach(card => {
                    card.style.pointerEvents = 'none';
                });
                
                this.gameState.updateScore(isCorrect);
                this.gameState.selectedOption = selectedIndex;
                
                if (isCorrect) {
                    document.getElementById('current-prize').textContent = this.gameState.getCurrentPrize().toLocaleString();
                    document.getElementById('total-prize').textContent = this.gameState.getCurrentPrize().toLocaleString();
                    
                    if (this.gameState.currentQuestion < this.questions.length - 1) {
                        setTimeout(() => {
                            const nextBtn = document.getElementById('next-btn');
                            if (nextBtn) {
                                nextBtn.disabled = false;
                                nextBtn.classList.remove('disabled');
                            }
                        }, 1000);
                    } else {
                        setTimeout(() => this.endGame(true), 2000);
                    }
                } else {
                    setTimeout(() => this.endGame(false), 2000);
                }
                
                this.updatePrizesList();
            }

            nextQuestion() {
                if (this.gameState.nextQuestion()) {
                    this.showQuestion();
                } else {
                    this.endGame(true);
                }
            }

            showWithdrawModal() {
                const safePrize = this.gameState.getSafePrize();
                const withdrawAmount = document.getElementById('withdraw-amount');
                if (withdrawAmount) {
                    withdrawAmount.textContent = safePrize.toLocaleString();
                }
                document.getElementById('withdraw-modal').classList.add('active');
            }

            confirmWithdraw() {
                const safePrize = this.gameState.getSafePrize();
                this.gameState.score = safePrize;
                document.getElementById('withdraw-modal').classList.remove('active');
                this.endGame(false);
            }

            useFiftyFifty() {
                if (!this.gameState.lifelines.fiftyFifty || !this.currentQuestionObj) return;
                
                const correctIndex = this.currentQuestionObj.correct;
                let wrongOptions = [0, 1, 2, 3].filter(idx => idx !== correctIndex);
                
                wrongOptions.sort(() => Math.random() - 0.5);
                const toRemove = wrongOptions.slice(0, 2);
                
                toRemove.forEach(idx => {
                    const button = document.querySelectorAll('.option-card')[idx];
                    if (button) {
                        button.style.opacity = '0.3';
                        button.style.pointerEvents = 'none';
                    }
                });
                
                this.gameState.useLifeline('fiftyFifty');
                const fiftyFiftyBtn = document.getElementById('fifty-fifty');
                if (fiftyFiftyBtn) {
                    fiftyFiftyBtn.disabled = true;
                    fiftyFiftyBtn.classList.add('disabled');
                }
            }

            useAskAudience() {
                if (!this.gameState.lifelines.askAudience || !this.currentQuestionObj) return;
                
                const correctIndex = this.currentQuestionObj.correct;
                let percentages = [0, 0, 0, 0];
                percentages[correctIndex] = 50 + Math.floor(Math.random() * 30);
                
                let remaining = 100 - percentages[correctIndex];
                for (let i = 0; i < 4; i++) {
                    if (i !== correctIndex) {
                        percentages[i] = Math.floor(Math.random() * remaining);
                        remaining -= percentages[i];
                    }
                }
                
                alert(`تصويت الجمهور:
                أ: ${percentages[0]}%
                ب: ${percentages[1]}%
                ج: ${percentages[2]}%
                د: ${percentages[3]}%`);
                
                this.gameState.useLifeline('askAudience');
                const askAudienceBtn = document.getElementById('ask-audience');
                if (askAudienceBtn) {
                    askAudienceBtn.disabled = true;
                    askAudienceBtn.classList.add('disabled');
                }
            }

            usePhoneFriend() {
                if (!this.gameState.lifelines.phoneFriend || !this.currentQuestionObj) return;
                
                const correctIndex = this.currentQuestionObj.correct;
                const confidence = Math.floor(Math.random() * 30) + 70;
                
                const options = ['أ', 'ب', 'ج', 'د'];
                alert(`الصديق: "أعتقد أن الإجابة الصحيحة هي ${options[correctIndex]}... أنا ${confidence}% متأكد"`);
                
                this.gameState.useLifeline('phoneFriend');
                const phoneFriendBtn = document.getElementById('phone-friend');
                if (phoneFriendBtn) {
                    phoneFriendBtn.disabled = true;
                    phoneFriendBtn.classList.add('disabled');
                }
            }

            toggleSound() {
                const soundBtn = document.getElementById('sound-toggle');
                if (!soundBtn) return;
                
                const icon = soundBtn.querySelector('i');
                if (icon.classList.contains('fa-volume-up')) {
                    icon.className = 'fas fa-volume-mute';
                    alert('تم إيقاف الصوت');
                } else {
                    icon.className = 'fas fa-volume-up';
                    alert('تم تشغيل الصوت');
                }
            }

            showHelpModal() {
                document.getElementById('help-modal').classList.add('active');
            }

            endGame(isWin) {
                clearInterval(this.currentTimer);
                this.gameState.gameActive = false;
                
                const container = document.getElementById('game-container');
                if (!container) return;
                
                container.innerHTML = `
                    <div class="container">
                        <div id="result-screen" class="screen active">
                            <div class="result-container">
                                <div class="result-header">
                                    <div class="result-badge">
                                        <i class="fas fa-${isWin ? 'trophy' : 'sad-tear'}"></i>
                                    </div>
                                    <h1 id="result-title">${isWin ? 'مبروك! فزت' : 'انتهت اللعبة'}</h1>
                                    <p class="result-subtitle">${isWin ? 'لقد أتممت اللعبة بنجاح' : 'للأسف لم تربح المليون'}</p>
                                </div>
                                
                                <div class="result-card">
                                    <div class="result-player">
                                        <div class="result-avatar">
                                            <i class="fas fa-user"></i>
                                            <div class="avatar-crown">
                                                <i class="fas fa-crown"></i>
                                            </div>
                                        </div>
                                        <h2 id="result-player-name">${this.gameState.playerName}</h2>
                                        <div class="player-rank">
                                            <i class="fas fa-star"></i>
                                            <span>المستوى ${Math.min(Math.floor(this.gameState.currentQuestion / 5) + 1, 3)}</span>
                                        </div>
                                    </div>
                                    
                                    <div class="result-prize">
                                        <div class="prize-amount-large">
                                            <span class="currency">$</span>
                                            <span id="final-prize">${this.gameState.score.toLocaleString()}</span>
                                        </div>
                                        <div class="prize-label">قيمة الجائزة التي ربحتها</div>
                                        <div class="prize-breakdown">
                                            <div class="breakdown-item">
                                                <span>الإجابات الصحيحة</span>
                                                <span>${this.gameState.totalCorrect}</span>
                                            </div>
                                            <div class="breakdown-item">
                                                <span>الأسئلة المجابة</span>
                                                <span>${this.gameState.currentQuestion + 1}</span>
                                            </div>
                                            <div class="breakdown-item">
                                                <span>نسبة النجاح</span>
                                                <span>${this.gameState.getAccuracy()}%</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="result-stats">
                                        <div class="stats-grid">
                                            <div class="stat-box">
                                                <i class="fas fa-clock"></i>
                                                <div class="stat-value">${this.gameState.getPlayTime()}</div>
                                                <div class="stat-label">ثانية</div>
                                            </div>
                                            <div class="stat-box">
                                                <i class="fas fa-life-ring"></i>
                                                <div class="stat-value">${CONFIG.LIFELINES_COUNT - this.gameState.getRemainingLifelines()}</div>
                                                <div class="stat-label">مساعدات مستخدمة</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="result-actions">
                                        <button class="result-btn primary" id="play-again-btn">
                                            <i class="fas fa-redo"></i>
                                            <span>العب مرة أخرى</span>
                                        </button>
                                        <button class="result-btn secondary" id="main-menu-btn">
                                            <i class="fas fa-home"></i>
                                            <span>القائمة الرئيسية</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                this.saveHighScore();
                
                setTimeout(() => {
                    document.getElementById('play-again-btn').addEventListener('click', () => {
                        window.location.reload();
                    });
                    
                    document.getElementById('main-menu-btn').addEventListener('click', () => {
                        window.location.href = 'start.html';
                    });
                }, 100);
            }

            saveHighScore() {
                const highScores = JSON.parse(localStorage.getItem('millionaireHighScores')) || [];
                
                highScores.push({
                    name: this.gameState.playerName,
                    score: this.gameState.score,
                    date: new Date().toISOString(),
                    questions: this.gameState.currentQuestion + 1,
                    correct: this.gameState.totalCorrect
                });
                
                highScores.sort((a, b) => b.score - a.score);
                const topScores = highScores.slice(0, 10);
                localStorage.setItem('millionaireHighScores', JSON.stringify(topScores));
            }
        }

        // بدء اللعبة
        document.addEventListener('DOMContentLoaded', () => {
            const game = new MillionaireGame();
        });
    </script>
</body>
    </html>
